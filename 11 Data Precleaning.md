# 11. 데이터 전처리와 파생변수 생성


## 11.1 결측값 처리

결측값 처리 전 데이터 탐색을 통해 결측값이 어떤 형태로 주어져있는지 파악해야 한다

- 완전 무작위 결측(MCAR)

>결측값이 무작위로 발생하는 경우   
> 데이터를 제거해도 편향이 발생하지 않음

- 무작위 결측(CAR)
>다른 변수의 특성에 의해 해당 변수의 결측치가 체계적으로 발생한 경우

- 비무작위 결측(NMAR)
> 결측값들이 해당 변수 자체의 특성을 갖고 있는 경우   
>> 마트의 고객 정보 데아터에서 '고객 소득' 변수의 결측값들이, 고객이 소득을 공개하기 꺼려서 비어 있는 경우
---

### 결측값 처리 방법

- 표본 제거 방법(Completes analysis)
> 결측값이 심하게 많은 변수를 제거하거나 결측값이 포함된 행을 제외하고 데이터 분석을 하는 방법    
전체 데이터에서 결측값이 10% 미만일 경우 사용

- 평균 대치법(Mean Imputation)
> 결측값을 제외한 온전한 값드릐 평균을 구한 다음, 그 평균 값을 결측값들에 대치하는 것   
유사한 방법으로 최반값, 중앙값, 최댓값, 최솟값 대치도 존재
>> 장점: 사용하기 간단하고 결측 표존 제거 방법을 어느정도 보완해줄 수 있음   
단점: 관측된 데이터의 평균을 사용하기 때문에 통계량의 표준오차가 왜곡되거나 축소되어 나타나고 따라서 p-value가 부정확하게 됨

표본제거 방법과 평균대치법 모두 결측값이 완전 무작위 결측값일 때만 적절한 방법임

- 보간법
> 데이터가 시계열적 특성을 가지고 있을 때 사용   

>인덱스의 간격이 불규칙하거나 결측값이 두 번 이상 연달아 있을 때는 선형적인 수치 값을 계산해 보는 보간법을 사용함

- 회귀 대치법
> 해당 변수와 다른 변수 사이의 관계썽을 고려하여 결측값을 계산하는 방법
>> 추정하고자 하는 결측값을 가진 변수를 종속변수로 하고, 나머지 변수를 독립변수로 하여 추정한 회귀식을 통해 결측값을 대치하는 것
>>>결측된 변수의 분산을 과소 추정하는 문제가 존재   
인위적으로 회귀식에 확률 오차항을 추가하는 **확률적 회귀대치법**을 사용하여 변동성을 조정하기도 함

- 다중 대치법
>표본오차 과소 추정 문제를 해결하기 위해 많이 사용   
단순 대치를 여러 번 수행하여 n가의 가상적 데이터를 생성하여 이들의 평규능로 결측값을 대치하는 방법
>> 1. 대치 단계(Imputations Step): 가능한 대치 값의 분포에서 추출된 서로 다른 값으로 결측치를 처리한 n개의 데이터셋 생성   
>> 2. 분석 단계(Analysis step): 생성된 각각의 데이터셋을 분석하여 모수의 추정치와 표준오차 계산 
>> 3. 결합 단계(Pooling Step): 계산된 각 데이터 셋의 추정치와 표준오차를 결합하여 최종 결측 대치값 산출

> 가상적 데이터는 5개 내외 정도만 생성해도 됨, 단 결측값의 비율이 증가할수록 가상데이터도 많이 생성해야 검정력이 증가함

